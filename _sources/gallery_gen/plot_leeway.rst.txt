.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_gallery_gen_plot_leeway.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gallery_gen_plot_leeway.py:


Leeway
===============================

asdf

Testing some stuff1
--------------------

Here's the animation..



.. code-block:: default


    from opendrift.readers import reader_netCDF_CF_generic
    from opendrift.models.leeway import Leeway
    import matplotlib.pyplot as plt

    lw = Leeway(loglevel=0)  # Set loglevel to 0 for debug information

    # Arome
    #reader_arome = reader_netCDF_CF_generic.Reader('http://thredds.met.no/thredds/dodsC/meps25files/meps_det_extracted_2_5km_latest.nc')
    reader_arome = reader_netCDF_CF_generic.Reader(lw.test_data_folder() +
        '16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc')

    # Norkyst
    #reader_norkyst = reader_netCDF_CF_generic.Reader('http://thredds.met.no/thredds/dodsC/sea/norkyst800m/1h/aggregate_be')
    reader_norkyst = reader_netCDF_CF_generic.Reader(lw.test_data_folder() +
        '16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc')





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /root/project/opendrift/models/basemodel.py:1845: SyntaxWarning: "is not" with a literal. Did you mean "!="?
      if varname is not 'z':
    /root/project/opendrift/models/basemodel.py:3200: SyntaxWarning: "is" with a literal. Did you mean "=="?
      if title is 'auto':
    13:05:44 INFO: OpenDriftSimulation initialised (version 1.1.0)
    13:05:44 INFO: Opening dataset: /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
    13:05:44 INFO: Opening file with Dataset
    13:05:44 DEBUG: Finding coordinate variables.
    13:05:44 DEBUG: Parsing variable: latitude
    13:05:44 DEBUG: Parsing variable: longitude
    13:05:44 DEBUG: Parsing variable: projection_lambert
    13:05:44 DEBUG: Parsing CF grid mapping dictionary: {'grid_mapping_name': 'lambert_conformal_conic', 'standard_parallel': array([63., 63.]), 'longitude_of_central_meridian': 15.0, 'latitude_of_projection_origin': 63.0, 'earth_radius': 6371000.0, 'proj4': '+proj=lcc +lon_0=15 +lat_0=63 +lat_1=63 +lat_2=63 +R=6.371e+06 +units=m +no_defs'}
    13:05:44 INFO: Could not parse CF grid_mapping
    13:05:44 DEBUG: Parsing variable: time
    13:05:44 DEBUG: Parsing variable: x
    13:05:44 DEBUG: Parsing variable: x_wind_10m
    13:05:44 DEBUG: Parsing variable: y
    13:05:44 DEBUG: Parsing variable: y_wind_10m
    13:05:44 DEBUG: Setting buffer size 10 for reader /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc, assuming a maximum average speed of 5 m/s.
    13:05:44 DEBUG: Adding new variable mappings
    13:05:44 INFO: Opening dataset: /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
    13:05:44 INFO: Opening file with Dataset
    13:05:44 DEBUG: Finding coordinate variables.
    13:05:44 DEBUG: Parsing variable: X
    13:05:44 DEBUG: Parsing variable: Y
    13:05:44 DEBUG: Parsing variable: depth
    13:05:44 DEBUG: Parsing variable: projection_stere
    13:05:44 DEBUG: Parsing CF grid mapping dictionary: {'grid_mapping_name': 'polar_stereographic', 'scale_factor_at_projection_origin': 0.9330127018922193, 'straight_vertical_longitude_from_pole': 70.0, 'latitude_of_projection_origin': 90.0, 'earth_radius': 6371000.0, 'proj4': '+proj=stere +lat_0=90 +lon_0=70 +lat_ts=60 +units=m +a=6.371e+06 +e=0 +no_defs'}
    13:05:44 INFO: Could not parse CF grid_mapping
    13:05:44 DEBUG: Parsing variable: time
    13:05:44 DEBUG: Parsing variable: u
    13:05:44 DEBUG: Parsing variable: v
    13:05:44 DEBUG: Setting buffer size 25 for reader /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc, assuming a maximum average speed of 5 m/s.
    13:05:44 DEBUG: Adding new variable mappings




does this work?


.. code-block:: default


    # Adding readers succesively, and specifying which variables they
    # shall provide. This way, order of adding readers does not matter,
    # except for small rounding differences due to different projection
    lw.add_reader(reader_norkyst,
                  variables=['x_sea_water_velocity', 'y_sea_water_velocity'])
    lw.add_reader(reader_arome,
                  variables=['x_wind', 'y_wind'])
    lw.fallback_values['x_sea_water_velocity'] = 0
    lw.fallback_values['y_sea_water_velocity'] = 0

    # Seeding some particles
    lon = 4.5; lat = 60.0; # Outside Bergen

    # Seed leeway elements at defined position and time
    objType = 26  # 26 = Life-raft, no ballast
    lw.seed_elements(lon, lat, radius=1000, number=3000,
                     time=reader_arome.start_time, objectType=objType)

    lw.set_projection('+proj=merc')

    # Running model (until end of driver data)
    lw.run(steps=60, time_step=900)
    lw.animation(filename='plot_leeway.gif')
    plt.close('all')





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    generating memmap landmask from tif..
    /opt/conda/envs/opendrift_docs/lib/python3.8/site-packages/cartopy/io/__init__.py:260: DownloadWarning: Downloading: https://www.ngdc.noaa.gov/mgg/shorelines/data/gshhs/oldversions/version2.2.0/GSHHS_shp_2.2.0.zip
      warnings.warn('Downloading: {}'.format(url), DownloadWarning)
    /root/project/opendrift/models/basemodel.py:2804: UserWarning: Tight layout not applied. The left and right margins cannot be made large enough to accommodate all axes decorations. 
      fig.canvas.draw()




Testing some stuff
------------------

Here's the animation..

.. image:: /gallery/plot_leeway.gif


.. code-block:: default


    # Print and plot results
    print(lw)
    #lw.animation(filename='leeway.gif')
    lw.plot()



.. image:: /gallery_gen/images/sphx_glr_plot_leeway_001.png
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    ===========================
    --------------------
    Reader performance:
    --------------------
    /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
     0:00:06.5  total
     0:00:00.0  preparing
     0:00:00.0  reading
     0:00:00.0  interpolation
     0:00:00.0  interpolation_time
     0:00:06.2  rotating vectors
     0:00:00.0  masking
    --------------------
    /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
     0:00:06.5  total
     0:00:00.0  preparing
     0:00:00.0  reading
     0:00:00.0  interpolation
     0:00:00.0  interpolation_time
     0:00:06.3  rotating vectors
     0:00:00.0  masking
    --------------------
    global_landmask
     0:00:00.7  total
     0:00:00.0  preparing
     0:00:00.7  reading
     0:00:00.0  interpolation_time
     0:00:00.0  masking
    --------------------
    Performance:
       37.5 total time
        0.0 configuration
       22.2 preparing main loop
         22.2 making dynamical landmask
          0.0 moving elements to ocean
         14.2 readers
            0.8 global_landmask
            0.1 postprocessing
       15.2 main loop
            6.5 /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
            6.5 /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
          0.7 updating elements
        0.0 cleaning up
    --------------------
    ===========================
    Model:  Leeway     (OpenDrift version 1.1.0)
            2992 active LeewayObj particles  (8 deactivated, 0 scheduled)
    Projection: +proj=merc
    -------------------
    Environment variables:
      -----
      x_sea_water_velocity
      y_sea_water_velocity
         1) /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
      -----
      x_wind
      y_wind
         1) /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
      -----
      land_binary_mask
         1) global_landmask

    Time:
            Start: 2015-11-16 00:00:00
            Present: 2015-11-16 15:00:00
            Calculation steps: 60 * 0:15:00 - total time: 15:00:00
            Output steps: 16 * 1:00:00
    ===========================

    /root/project/opendrift/models/basemodel.py:3219: UserWarning: Tight layout not applied. The left and right margins cannot be made large enough to accommodate all axes decorations. 
      fig.canvas.draw()

    (<cartopy.mpl.geoaxes.GeoAxesSubplot object at 0x7fbfb8824520>, <module 'matplotlib.pyplot' from '/opt/conda/envs/opendrift_docs/lib/python3.8/site-packages/matplotlib/pyplot.py'>)




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  36.133 seconds)


.. _sphx_glr_download_gallery_gen_plot_leeway.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_leeway.py <plot_leeway.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_leeway.ipynb <plot_leeway.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
