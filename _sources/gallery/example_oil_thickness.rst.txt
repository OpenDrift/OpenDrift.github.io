.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_gallery_example_oil_thickness.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gallery_example_oil_thickness.py:


Oil thickness
==================================


.. code-block:: default


    from datetime import datetime, timedelta
    import matplotlib.pyplot as plt
    import numpy as np
    from opendrift.models.openoil3D import OpenOil3D


    number = 10000
    timestep = timedelta(minutes=10)
    timestep_output = timedelta(minutes=60)
    duration = timedelta(hours=20)
    mass_oil = 2000  # mass oil per particle
    oiltype = '*GENERIC DIESEL'
    #oiltype = '*GENERIC BUNKER C'








First run, where surface oil thickness is updated


.. code-block:: default

    o1 = OpenOil3D(loglevel=30, weathering_model='noaa')







Northwards wind, eastwards current


.. code-block:: default

    o1.fallback_values['land_binary_mask'] = 0
    o1.fallback_values['x_wind'] = 0
    o1.fallback_values['y_wind'] = 7
    o1.fallback_values['sea_surface_wave_stokes_drift_x_velocity'] = 0
    o1.fallback_values['sea_surface_wave_stokes_drift_y_velocity'] = .3
    o1.fallback_values['x_sea_water_velocity'] = .1
    o1.fallback_values['y_sea_water_velocity'] = 0







Using Johansen droplet spectrum, which depends on oil film thickness


.. code-block:: default

    o1.set_config('wave_entrainment:droplet_size_distribution',
                 'Johansen et al. (2015)')
    o1.set_config('drift:wind_uncertainty', 2)
    o1.set_config('drift:current_uncertainty', .1)
    o1.set_config('processes:dispersion', False)
    o1.set_config('processes:update_oilfilm_thickness', True)

    o1.seed_elements(lon=4.5, lat=60, number=number,
                    mass_oil=mass_oil, radius=1000,
                    oiltype=oiltype,
                    time=datetime.now())
    o1.run(time_step=timestep, time_step_output=timestep_output,
           duration=duration)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /opt/conda/envs/opendrift/lib/python3.8/site-packages/scipy/optimize/minpack.py:807: OptimizeWarning: Covariance of the parameters could not be estimated
      warnings.warn('Covariance of the parameters could not be estimated',
    Updating oil film thickness for 10000 of 10000 elements at surface
    Updating oil film thickness for 4909 of 10000 elements at surface
    Updating oil film thickness for 4230 of 10000 elements at surface
    Updating oil film thickness for 3716 of 10000 elements at surface
    Updating oil film thickness for 3358 of 10000 elements at surface
    Updating oil film thickness for 3040 of 10000 elements at surface
    Updating oil film thickness for 2862 of 10000 elements at surface
    Updating oil film thickness for 2631 of 10000 elements at surface
    Updating oil film thickness for 2418 of 10000 elements at surface
    Updating oil film thickness for 2267 of 10000 elements at surface
    Updating oil film thickness for 2103 of 10000 elements at surface
    Updating oil film thickness for 1944 of 10000 elements at surface
    Updating oil film thickness for 1883 of 10000 elements at surface
    Updating oil film thickness for 1782 of 10000 elements at surface
    Updating oil film thickness for 1758 of 10000 elements at surface
    Updating oil film thickness for 1629 of 10000 elements at surface
    Updating oil film thickness for 1561 of 10000 elements at surface
    Updating oil film thickness for 1475 of 10000 elements at surface
    Updating oil film thickness for 1462 of 10000 elements at surface
    Updating oil film thickness for 1372 of 10000 elements at surface
    Updating oil film thickness for 1336 of 10000 elements at surface
    Updating oil film thickness for 1341 of 10000 elements at surface
    Updating oil film thickness for 1287 of 10000 elements at surface
    Updating oil film thickness for 1242 of 10000 elements at surface
    Updating oil film thickness for 1188 of 10000 elements at surface
    Updating oil film thickness for 1212 of 10000 elements at surface
    Updating oil film thickness for 1088 of 10000 elements at surface
    Updating oil film thickness for 1038 of 10000 elements at surface
    Updating oil film thickness for 1023 of 10000 elements at surface
    Updating oil film thickness for 995 of 10000 elements at surface
    Updating oil film thickness for 978 of 10000 elements at surface
    Updating oil film thickness for 968 of 10000 elements at surface
    Updating oil film thickness for 919 of 10000 elements at surface
    Updating oil film thickness for 884 of 10000 elements at surface
    Updating oil film thickness for 890 of 10000 elements at surface
    Updating oil film thickness for 887 of 10000 elements at surface
    Updating oil film thickness for 852 of 10000 elements at surface
    Updating oil film thickness for 840 of 10000 elements at surface
    Updating oil film thickness for 831 of 10000 elements at surface
    Updating oil film thickness for 828 of 10000 elements at surface
    Updating oil film thickness for 770 of 10000 elements at surface
    Updating oil film thickness for 755 of 10000 elements at surface
    Updating oil film thickness for 785 of 10000 elements at surface
    Updating oil film thickness for 748 of 10000 elements at surface
    Updating oil film thickness for 745 of 10000 elements at surface
    Updating oil film thickness for 758 of 10000 elements at surface
    Updating oil film thickness for 754 of 10000 elements at surface
    Updating oil film thickness for 718 of 10000 elements at surface
    Updating oil film thickness for 704 of 10000 elements at surface
    Updating oil film thickness for 683 of 10000 elements at surface
    Updating oil film thickness for 648 of 10000 elements at surface
    Updating oil film thickness for 653 of 10000 elements at surface
    Updating oil film thickness for 661 of 10000 elements at surface
    Updating oil film thickness for 675 of 10000 elements at surface
    Updating oil film thickness for 664 of 10000 elements at surface
    Updating oil film thickness for 616 of 10000 elements at surface
    Updating oil film thickness for 588 of 10000 elements at surface
    Updating oil film thickness for 593 of 10000 elements at surface
    Updating oil film thickness for 605 of 10000 elements at surface
    Updating oil film thickness for 608 of 10000 elements at surface
    Updating oil film thickness for 614 of 10000 elements at surface
    Updating oil film thickness for 572 of 10000 elements at surface
    Updating oil film thickness for 546 of 10000 elements at surface
    Updating oil film thickness for 578 of 10000 elements at surface
    Updating oil film thickness for 560 of 10000 elements at surface
    Updating oil film thickness for 540 of 10000 elements at surface
    Updating oil film thickness for 504 of 10000 elements at surface
    Updating oil film thickness for 531 of 10000 elements at surface
    Updating oil film thickness for 513 of 10000 elements at surface
    Updating oil film thickness for 505 of 10000 elements at surface
    Updating oil film thickness for 554 of 10000 elements at surface
    Updating oil film thickness for 502 of 10000 elements at surface
    Updating oil film thickness for 491 of 10000 elements at surface
    Updating oil film thickness for 484 of 10000 elements at surface
    Updating oil film thickness for 478 of 10000 elements at surface
    Updating oil film thickness for 480 of 10000 elements at surface
    Updating oil film thickness for 501 of 10000 elements at surface
    Updating oil film thickness for 496 of 10000 elements at surface
    Updating oil film thickness for 467 of 10000 elements at surface
    Updating oil film thickness for 474 of 10000 elements at surface
    Updating oil film thickness for 499 of 10000 elements at surface
    Updating oil film thickness for 496 of 10000 elements at surface
    Updating oil film thickness for 483 of 10000 elements at surface
    Updating oil film thickness for 509 of 10000 elements at surface
    Updating oil film thickness for 511 of 10000 elements at surface
    Updating oil film thickness for 496 of 10000 elements at surface
    Updating oil film thickness for 443 of 10000 elements at surface
    Updating oil film thickness for 459 of 10000 elements at surface
    Updating oil film thickness for 427 of 10000 elements at surface
    Updating oil film thickness for 419 of 10000 elements at surface
    Updating oil film thickness for 420 of 10000 elements at surface
    Updating oil film thickness for 432 of 10000 elements at surface
    Updating oil film thickness for 452 of 10000 elements at surface
    Updating oil film thickness for 437 of 10000 elements at surface
    Updating oil film thickness for 395 of 10000 elements at surface
    Updating oil film thickness for 404 of 10000 elements at surface
    Updating oil film thickness for 406 of 10000 elements at surface
    Updating oil film thickness for 396 of 10000 elements at surface
    Updating oil film thickness for 389 of 10000 elements at surface
    Updating oil film thickness for 396 of 10000 elements at surface
    Updating oil film thickness for 414 of 10000 elements at surface
    Updating oil film thickness for 391 of 10000 elements at surface
    Updating oil film thickness for 371 of 10000 elements at surface
    Updating oil film thickness for 380 of 10000 elements at surface
    Updating oil film thickness for 357 of 10000 elements at surface
    Updating oil film thickness for 373 of 10000 elements at surface
    Updating oil film thickness for 336 of 10000 elements at surface
    Updating oil film thickness for 364 of 10000 elements at surface
    Updating oil film thickness for 347 of 10000 elements at surface
    Updating oil film thickness for 323 of 10000 elements at surface
    Updating oil film thickness for 346 of 10000 elements at surface
    Updating oil film thickness for 351 of 10000 elements at surface
    Updating oil film thickness for 375 of 10000 elements at surface
    Updating oil film thickness for 362 of 10000 elements at surface
    Updating oil film thickness for 379 of 10000 elements at surface
    Updating oil film thickness for 373 of 10000 elements at surface
    Updating oil film thickness for 355 of 10000 elements at surface
    Updating oil film thickness for 377 of 10000 elements at surface
    Updating oil film thickness for 370 of 10000 elements at surface
    Updating oil film thickness for 355 of 10000 elements at surface




Animation shows how oil thickness evolves,
and decreases due to evaporation and spreading


.. code-block:: default

    unitfactor=1e6  # show film thickness in micrometers
    o1.animation(color='oil_film_thickness', fast=True,
                 vmin=1e-7*unitfactor, vmax=1e-4*unitfactor,
                 unitfactor=unitfactor, surface_only=True,)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /root/project/opendrift/models/basemodel.py:2841: UserWarning: Tight layout not applied. The left and right margins cannot be made large enough to accommodate all axes decorations. 
      fig.canvas.draw()




.. image:: /gallery/animations/example_oil_thickness_0.gif

Second run, identical but without updating surface oil thickness


.. code-block:: default

    o2 = OpenOil3D(loglevel=30, weathering_model='noaa')
    o2.fallback_values = o1.fallback_values

    o2.set_config('wave_entrainment:droplet_size_distribution',
                 'Johansen et al. (2015)')
    o2.set_config('drift:wind_uncertainty', 2)
    o2.set_config('drift:current_uncertainty', .1)
    o2.set_config('processes:dispersion', False)
    o2.set_config('processes:update_oilfilm_thickness', False)

    o2.seed_elements(lon=4.5, lat=60, number=number,
                    mass_oil=mass_oil, radius=1000,
                    oiltype=oiltype,
                    time=datetime.now())
    o2.run(time_step=timestep, time_step_output=timestep_output,
           duration=duration)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /opt/conda/envs/opendrift/lib/python3.8/site-packages/scipy/optimize/minpack.py:807: OptimizeWarning: Covariance of the parameters could not be estimated
      warnings.warn('Covariance of the parameters could not be estimated',




Comparison plots


.. code-block:: default

    o1.plot_oil_budget()
    o2.plot_oil_budget()




.. image:: /gallery/images/sphx_glr_example_oil_thickness_001.png
    :class: sphx-glr-single-img





Entrainment


.. code-block:: default

    b1 = o1.get_oil_budget()
    b2 = o2.get_oil_budget()
    plt.plot(b1['mass_surface'], '-r', linewidth=2,
                label='Surface, updated thickness')
    plt.plot(b1['mass_submerged'], '--r', linewidth=2,
                label='Submerged, updated thickness')
    plt.plot(b1['mass_evaporated'], '-.r', linewidth=2,
                label='Evaporated, updated thickness')
    plt.plot(b2['mass_surface'], '-b', linewidth=2,
                label='Surface, constant thickness')
    plt.plot(b2['mass_submerged'], '--b', linewidth=2,
                label='Submerged, constant thickness')
    plt.plot(b2['mass_evaporated'], '-.b', linewidth=2,
                label='Evaporated, constant thickness')
    plt.legend()
    plt.xlabel('Time step')
    plt.show()




.. image:: /gallery/images/sphx_glr_example_oil_thickness_002.png
    :class: sphx-glr-single-img





We see that with the updated film thickness,
the droplets are getting gradually smaller


.. code-block:: default

    r1 = o1.get_property('diameter')[0]
    r2 = o2.get_property('diameter')[0]
    plt.plot(np.median(r1*1e6, 1))
    plt.plot(np.median(r2*1e6, 1))
    plt.legend(['With updated film thickness', 'With constant film thickness'])
    plt.xlabel('Time step')
    plt.ylabel('Median droplet diameter  [micrometer]')
    plt.show()




.. image:: /gallery/images/sphx_glr_example_oil_thickness_003.png
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /opt/conda/envs/opendrift/lib/python3.8/site-packages/numpy/core/fromnumeric.py:746: UserWarning: Warning: 'partition' will ignore the 'mask' of the MaskedArray.
      a.partition(kth, axis=axis, kind=kind, order=order)
    /opt/conda/envs/opendrift/lib/python3.8/site-packages/numpy/core/fromnumeric.py:746: UserWarning: Warning: 'partition' will ignore the 'mask' of the MaskedArray.
      a.partition(kth, axis=axis, kind=kind, order=order)




We see that oil film thickness has virtually no impact on horizontal drift


.. code-block:: default

    o1.animation(compare=o2, fast=True,
                 legend=['Updated film thickness', 'Constant/default film thickness'],)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /root/project/opendrift/models/basemodel.py:2841: UserWarning: Tight layout not applied. The left and right margins cannot be made large enough to accommodate all axes decorations. 
      fig.canvas.draw()




.. image:: /gallery/animations/example_oil_thickness_1.gif


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 2 minutes  30.140 seconds)


.. _sphx_glr_download_gallery_example_oil_thickness.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: example_oil_thickness.py <example_oil_thickness.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: example_oil_thickness.ipynb <example_oil_thickness.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
