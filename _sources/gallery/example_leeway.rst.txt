.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_gallery_example_leeway.py>`     to download the full example code
    .. rst-class:: sphx-glr-example-title

    .. _sphx_glr_gallery_example_leeway.py:


Leeway
==================================


.. code-block:: default


    from datetime import timedelta
    from opendrift.readers import reader_global_landmask
    from opendrift.readers import reader_netCDF_CF_generic
    from opendrift.models.leeway import Leeway

    lw = Leeway(loglevel=0)  # Set loglevel to 0 for debug information

    # Arome
    #reader_arome = reader_netCDF_CF_generic.Reader('https://thredds.met.no/thredds/dodsC/mepslatest/meps_lagged_6_h_latest_2_5km_latest.nc')
    reader_arome = reader_netCDF_CF_generic.Reader(lw.test_data_folder() +
        '16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc')

    # Norkyst
    #reader_norkyst = reader_netCDF_CF_generic.Reader('https://thredds.met.no/thredds/dodsC/mepslatest/meps_lagged_6_h_latest_2_5km_latest.nc')
    reader_norkyst = reader_netCDF_CF_generic.Reader(lw.test_data_folder() +
        '16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc')

    # Landmask
    reader_landmask = reader_global_landmask.Reader(
                        llcrnrlon=3.3, llcrnrlat=59.5,
                        urcrnrlon=5.5, urcrnrlat=62.5)

    #lw.add_reader([reader_norkyst, reader_arome, reader_landmask])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    10:43:11 INFO: OpenDriftSimulation initialised (version 1.2.1)
    10:43:11 INFO: Opening dataset: /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
    10:43:11 INFO: Opening file with Dataset
    10:43:11 DEBUG: Finding coordinate variables.
    10:43:11 DEBUG: Parsing variable: latitude
    10:43:11 DEBUG: Parsing variable: longitude
    10:43:11 DEBUG: Parsing variable: projection_lambert
    10:43:11 DEBUG: Parsing CF grid mapping dictionary: {'grid_mapping_name': 'lambert_conformal_conic', 'standard_parallel': array([63., 63.]), 'longitude_of_central_meridian': 15.0, 'latitude_of_projection_origin': 63.0, 'earth_radius': 6371000.0, 'proj4': '+proj=lcc +lon_0=15 +lat_0=63 +lat_1=63 +lat_2=63 +R=6.371e+06 +units=m +no_defs'}
    10:43:11 INFO: Could not parse CF grid_mapping
    10:43:11 DEBUG: Parsing variable: time
    10:43:11 DEBUG: Parsing variable: x
    10:43:11 DEBUG: Parsing variable: x_wind_10m
    10:43:11 DEBUG: Parsing variable: y
    10:43:11 DEBUG: Parsing variable: y_wind_10m
    10:43:11 DEBUG: Setting buffer size 10 for reader /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc, assuming a maximum average speed of 5 m/s.
    10:43:11 DEBUG: Adding new variable mappings
    10:43:11 INFO: Opening dataset: /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
    10:43:11 INFO: Opening file with Dataset
    10:43:11 DEBUG: Finding coordinate variables.
    10:43:11 DEBUG: Parsing variable: X
    10:43:11 DEBUG: Parsing variable: Y
    10:43:11 DEBUG: Parsing variable: depth
    10:43:11 DEBUG: Parsing variable: projection_stere
    10:43:11 DEBUG: Parsing CF grid mapping dictionary: {'grid_mapping_name': 'polar_stereographic', 'scale_factor_at_projection_origin': 0.9330127018922193, 'straight_vertical_longitude_from_pole': 70.0, 'latitude_of_projection_origin': 90.0, 'earth_radius': 6371000.0, 'proj4': '+proj=stere +lat_0=90 +lon_0=70 +lat_ts=60 +units=m +a=6.371e+06 +e=0 +no_defs'}
    10:43:11 DEBUG: Parsing variable: time
    10:43:11 DEBUG: Parsing variable: u
    10:43:11 DEBUG: Parsing variable: v
    10:43:11 DEBUG: Setting buffer size 25 for reader /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc, assuming a maximum average speed of 5 m/s.
    10:43:11 DEBUG: Adding new variable mappings
    10:43:11 DEBUG: Adding new variable mappings




Adding readers succesively, and specifying which variables they
shall provide. This way, order of adding readers does not matter,
except for small rounding differences due to different projection


.. code-block:: default

    lw.add_reader(reader_norkyst,
                  variables=['x_sea_water_velocity', 'y_sea_water_velocity'])
    lw.add_reader(reader_arome,
                  variables=['x_wind', 'y_wind'])
    lw.add_reader(reader_landmask,
                  variables=['land_binary_mask'])
    lw.fallback_values['x_sea_water_velocity'] = 0
    lw.fallback_values['y_sea_water_velocity'] = 0








Seed leeway elements at defined position and time


.. code-block:: default

    objType = 26  # 26 = Life-raft, no ballast
    lw.seed_elements(lon=4.5, lat=60.0, radius=1000, number=3000,
                     time=reader_arome.start_time, objectType=objType)








Running model (until end of driver data)


.. code-block:: default

    lw.run(duration=timedelta(hours=60), time_step=900, time_step_output=3600)








Print and plot results


.. code-block:: default

    print(lw)
    # lw.animation()
    lw.animation(background=['x_sea_water_velocity', 'y_sea_water_velocity'])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    ===========================
    --------------------
    Reader performance:
    --------------------
    /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
     0:00:07.5  total
     0:00:00.1  preparing
     0:00:00.2  reading
     0:00:00.5  interpolation
     0:00:00.0  interpolation_time
     0:00:06.5  rotating vectors
     0:00:00.0  masking
    --------------------
    /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
     0:00:07.1  total
     0:00:00.1  preparing
     0:00:00.1  reading
     0:00:00.2  interpolation
     0:00:00.0  interpolation_time
     0:00:06.5  rotating vectors
     0:00:00.0  masking
    --------------------
    global_landmask
     0:00:00.5  total
     0:00:00.0  preparing
     0:00:00.4  reading
     0:00:00.0  interpolation_time
     0:00:00.0  masking
    --------------------
    Performance:
       21.7 total time
        2.3 configuration
        0.0 preparing main loop
          0.0 moving elements to ocean
         16.5 readers
            0.6 global_landmask
            0.4 postprocessing
       19.3 main loop
            7.6 /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
            7.2 /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
          2.0 updating elements
        0.0 cleaning up
    --------------------
    ===========================
    Model:  Leeway     (OpenDrift version 1.2.1)
            830 active LeewayObj particles  (2170 deactivated, 0 scheduled)
    Projection: +proj=stere +lat_0=90 +lon_0=70 +lat_ts=60 +units=m +a=6.371e+06 +e=0 +no_defs
    -------------------
    Environment variables:
      -----
      x_sea_water_velocity
      y_sea_water_velocity
         1) /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
      -----
      x_wind
      y_wind
         1) /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
      -----
      land_binary_mask
         1) global_landmask

    Time:
            Start: 2015-11-16 00:00:00
            Present: 2015-11-18 12:00:00
            Calculation steps: 240 * 0:15:00 - total time: 2 days, 12:00:00
            Output steps: 61 * 1:00:00
    ===========================

    /opt/conda/envs/opendrift/lib/python3.8/site-packages/cartopy/mpl/gridliner.py:307: UserWarning: The .xlabels_top attribute is deprecated. Please use .top_labels to toggle visibility instead.
      warnings.warn('The .xlabels_top attribute is deprecated. Please '
    /opt/conda/envs/opendrift/lib/python3.8/site-packages/cartopy/mpl/geoaxes.py:1546: MatplotlibDeprecationWarning: Using a string of single character colors as a color sequence is deprecated. Use an explicit list instead.
      result = matplotlib.axes.Axes.scatter(self, *args, **kwargs)
    /root/project/opendrift/models/basemodel.py:2859: UserWarning: Tight layout not applied. The left and right margins cannot be made large enough to accommodate all axes decorations. 
      fig.canvas.draw()




.. image:: /gallery/animations/example_leeway_0.gif


.. code-block:: default


    lw.plot(fast=True, background=['x_sea_water_velocity', 'y_sea_water_velocity'])



.. image:: /gallery/images/sphx_glr_example_leeway_001.png
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /opt/conda/envs/opendrift/lib/python3.8/site-packages/cartopy/mpl/gridliner.py:307: UserWarning: The .xlabels_top attribute is deprecated. Please use .top_labels to toggle visibility instead.
      warnings.warn('The .xlabels_top attribute is deprecated. Please '

    (<cartopy.mpl.geoaxes.GeoAxesSubplot object at 0x7fc9d32dd490>, <module 'matplotlib.pyplot' from '/opt/conda/envs/opendrift/lib/python3.8/site-packages/matplotlib/pyplot.py'>)




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 2 minutes  10.889 seconds)


.. _sphx_glr_download_gallery_example_leeway.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: example_leeway.py <example_leeway.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: example_leeway.ipynb <example_leeway.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
