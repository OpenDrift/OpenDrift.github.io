.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_gallery_example_leeway.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gallery_example_leeway.py:


Leeway
==================================


.. code-block:: default


    from datetime import timedelta
    from opendrift.readers import reader_global_landmask
    from opendrift.readers import reader_netCDF_CF_generic
    from opendrift.models.leeway import Leeway

    lw = Leeway(loglevel=0)  # Set loglevel to 0 for debug information

    # Arome
    #reader_arome = reader_netCDF_CF_generic.Reader('https://thredds.met.no/thredds/dodsC/mepslatest/meps_lagged_6_h_latest_2_5km_latest.nc')
    reader_arome = reader_netCDF_CF_generic.Reader(lw.test_data_folder() +
        '16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc')

    # Norkyst
    #reader_norkyst = reader_netCDF_CF_generic.Reader('https://thredds.met.no/thredds/dodsC/mepslatest/meps_lagged_6_h_latest_2_5km_latest.nc')
    reader_norkyst = reader_netCDF_CF_generic.Reader(lw.test_data_folder() +
        '16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc')

    # Landmask
    reader_landmask = reader_global_landmask.Reader(
                        llcrnrlon=3.3, llcrnrlat=59.5,
                        urcrnrlon=5.5, urcrnrlat=62.5)

    #lw.add_reader([reader_norkyst, reader_arome, reader_landmask])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    08:10:31 INFO: OpenDriftSimulation initialised (version 1.2.0)
    08:10:31 INFO: Opening dataset: /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
    08:10:31 INFO: Opening file with Dataset
    08:10:31 DEBUG: Finding coordinate variables.
    08:10:31 DEBUG: Parsing variable: latitude
    08:10:31 DEBUG: Parsing variable: longitude
    08:10:31 DEBUG: Parsing variable: projection_lambert
    08:10:31 DEBUG: Parsing CF grid mapping dictionary: {'grid_mapping_name': 'lambert_conformal_conic', 'standard_parallel': array([63., 63.]), 'longitude_of_central_meridian': 15.0, 'latitude_of_projection_origin': 63.0, 'earth_radius': 6371000.0, 'proj4': '+proj=lcc +lon_0=15 +lat_0=63 +lat_1=63 +lat_2=63 +R=6.371e+06 +units=m +no_defs'}
    08:10:31 INFO: Could not parse CF grid_mapping
    08:10:31 DEBUG: Parsing variable: time
    08:10:31 DEBUG: Parsing variable: x
    08:10:31 DEBUG: Parsing variable: x_wind_10m
    08:10:31 DEBUG: Parsing variable: y
    08:10:31 DEBUG: Parsing variable: y_wind_10m
    08:10:31 DEBUG: Setting buffer size 10 for reader /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc, assuming a maximum average speed of 5 m/s.
    08:10:31 DEBUG: Adding new variable mappings
    08:10:31 INFO: Opening dataset: /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
    08:10:31 INFO: Opening file with Dataset
    08:10:31 DEBUG: Finding coordinate variables.
    08:10:31 DEBUG: Parsing variable: X
    08:10:31 DEBUG: Parsing variable: Y
    08:10:31 DEBUG: Parsing variable: depth
    08:10:31 DEBUG: Parsing variable: projection_stere
    08:10:31 DEBUG: Parsing CF grid mapping dictionary: {'grid_mapping_name': 'polar_stereographic', 'scale_factor_at_projection_origin': 0.9330127018922193, 'straight_vertical_longitude_from_pole': 70.0, 'latitude_of_projection_origin': 90.0, 'earth_radius': 6371000.0, 'proj4': '+proj=stere +lat_0=90 +lon_0=70 +lat_ts=60 +units=m +a=6.371e+06 +e=0 +no_defs'}
    08:10:31 DEBUG: Parsing variable: time
    08:10:31 DEBUG: Parsing variable: u
    08:10:31 DEBUG: Parsing variable: v
    08:10:31 DEBUG: Setting buffer size 25 for reader /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc, assuming a maximum average speed of 5 m/s.
    08:10:31 DEBUG: Adding new variable mappings
    08:10:31 DEBUG: Adding new variable mappings




Adding readers succesively, and specifying which variables they
shall provide. This way, order of adding readers does not matter,
except for small rounding differences due to different projection


.. code-block:: default

    lw.add_reader(reader_norkyst,
                  variables=['x_sea_water_velocity', 'y_sea_water_velocity'])
    lw.add_reader(reader_arome,
                  variables=['x_wind', 'y_wind'])
    lw.add_reader(reader_landmask,
                  variables=['land_binary_mask'])
    lw.fallback_values['x_sea_water_velocity'] = 0
    lw.fallback_values['y_sea_water_velocity'] = 0








Seed leeway elements at defined position and time


.. code-block:: default

    objType = 26  # 26 = Life-raft, no ballast
    lw.seed_elements(lon=4.5, lat=60.0, radius=1000, number=3000,
                     time=reader_arome.start_time, objectType=objType)








Running model (until end of driver data)


.. code-block:: default

    lw.run(duration=timedelta(hours=60), time_step=900, time_step_output=3600)








Print and plot results


.. code-block:: default

    print(lw)
    # lw.animation()
    lw.animation(background=['x_sea_water_velocity', 'y_sea_water_velocity'])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    ===========================
    --------------------
    Reader performance:
    --------------------
    /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
     0:00:08.8  total
     0:00:00.1  preparing
     0:00:00.2  reading
     0:00:00.5  interpolation
     0:00:00.0  interpolation_time
     0:00:07.7  rotating vectors
     0:00:00.0  masking
    --------------------
    /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
     0:00:07.8  total
     0:00:00.1  preparing
     0:00:00.1  reading
     0:00:00.2  interpolation
     0:00:00.0  interpolation_time
     0:00:07.2  rotating vectors
     0:00:00.0  masking
    --------------------
    global_landmask
     0:00:00.6  total
     0:00:00.0  preparing
     0:00:00.5  reading
     0:00:00.0  interpolation_time
     0:00:00.0  masking
    --------------------
    Performance:
       24.4 total time
        2.6 configuration
        0.0 preparing main loop
          0.0 moving elements to ocean
         18.6 readers
            0.7 global_landmask
            0.4 postprocessing
       21.7 main loop
            8.8 /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
            7.9 /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
          2.1 updating elements
        0.0 cleaning up
    --------------------
    ===========================
    Model:  Leeway     (OpenDrift version 1.2.0)
            830 active LeewayObj particles  (2170 deactivated, 0 scheduled)
    Projection: +proj=stere +lat_0=90 +lon_0=70 +lat_ts=60 +units=m +a=6.371e+06 +e=0 +no_defs
    -------------------
    Environment variables:
      -----
      x_sea_water_velocity
      y_sea_water_velocity
         1) /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/norkyst800_subset_16Nov2015.nc
      -----
      x_wind
      y_wind
         1) /root/project/tests/test_data/16Nov2015_NorKyst_z_surface/arome_subset_16Nov2015.nc
      -----
      land_binary_mask
         1) global_landmask

    Time:
            Start: 2015-11-16 00:00:00
            Present: 2015-11-18 12:00:00
            Calculation steps: 240 * 0:15:00 - total time: 2 days, 12:00:00
            Output steps: 61 * 1:00:00
    ===========================

    /root/project/opendrift/models/basemodel.py:2841: UserWarning: Tight layout not applied. The left and right margins cannot be made large enough to accommodate all axes decorations. 
      fig.canvas.draw()




.. image:: /gallery/animations/example_leeway_0.gif


.. code-block:: default


    lw.plot(fast=True, background=['x_sea_water_velocity', 'y_sea_water_velocity'])



.. image:: /gallery/images/sphx_glr_example_leeway_001.png
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /root/project/opendrift/models/basemodel.py:3260: UserWarning: Tight layout not applied. The left and right margins cannot be made large enough to accommodate all axes decorations. 
      fig.canvas.draw()

    (<cartopy.mpl.geoaxes.GeoAxesSubplot object at 0x7fea5074c070>, <module 'matplotlib.pyplot' from '/opt/conda/envs/opendrift/lib/python3.8/site-packages/matplotlib/pyplot.py'>)




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  32.880 seconds)


.. _sphx_glr_download_gallery_example_leeway.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: example_leeway.py <example_leeway.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: example_leeway.ipynb <example_leeway.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
