
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gallery/example_oil_verticalmixing.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gallery_example_oil_verticalmixing.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gallery_example_oil_verticalmixing.py:


Oil vertical mixing
==================================

.. GENERATED FROM PYTHON SOURCE LINES 6-37

.. code-block:: Python


    import os
    from datetime import timedelta
    from opendrift.readers import reader_netCDF_CF_generic
    from opendrift.models.openoil import OpenOil


    o = OpenOil(loglevel=20)  # Set loglevel to 0 for debug information

    ncfile = 'oilmixing.nc'
    import_file = False  # Set to True to import previous run

    if import_file is True:
        o.io_import_file(ncfile)
    else:
        reader_arome = reader_netCDF_CF_generic.Reader('https://thredds.met.no/thredds/dodsC/mepslatest/meps_lagged_6_h_latest_2_5km_latest.nc')
        reader_norkyst = reader_netCDF_CF_generic.Reader('https://thredds.met.no/thredds/dodsC/sea/norkyst800m/1h/aggregate_be')

        o.add_reader([reader_norkyst, reader_arome])

        # Adjusting some configuration
        #o.set_config('vertical_mixing:diffusivitymodel', 'windspeed_Sundby1983')

        # Seed oil elements at defined position and time
        o.seed_elements(lon=4.9, lat=62.1, z=0, radius=1000, number=2000,
                        time=reader_arome.start_time)

        # Running model
        o.run(end_time=reader_arome.start_time + timedelta(hours=12),
              time_step=900, time_step_output=1800, outfile=ncfile)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    17:24:59 INFO    opendrift.models.basemodel:512: OpenDriftSimulation initialised (version 1.12.0 / v1.12.0-55-g4faa301)
    17:24:59 INFO    opendrift.readers:58: Opening file with xr.open_dataset
    17:25:00 INFO    opendrift.readers.reader_netCDF_CF_generic:338: Detected dimensions: {'time': 'time', 'x': 'x', 'y': 'y'}
    17:25:00 INFO    opendrift.readers:58: Opening file with xr.open_dataset
    17:25:07 INFO    opendrift.readers.reader_netCDF_CF_generic:338: Detected dimensions: {'x': 'X', 'y': 'Y', 'z': 'depth', 'time': 'time'}
    17:25:07 INFO    opendrift.models.openoil.openoil:1706: Oil type not specified, using default: GENERIC BUNKER C
    17:25:07 INFO    opendrift.models.openoil.adios.dirjs:86: Querying ADIOS database for oil: GENERIC BUNKER C
    17:25:07 INFO    opendrift.models.openoil.openoil:1715: Using density 988.1 and viscosity 0.021692333877975645 of oiltype GENERIC BUNKER C
    17:25:07 INFO    opendrift.models.basemodel.environment:218: Adding a dynamical landmask with max. priority based on assumed maximum speed of 1.3 m/s. Adding a customised landmask may be faster...
    17:25:11 INFO    opendrift.models.basemodel.environment:245: Fallback values will be used for the following variables which have no readers: 
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    sea_surface_wave_significant_height: 0.000000
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    sea_surface_wave_stokes_drift_x_velocity: 0.000000
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    sea_surface_wave_stokes_drift_y_velocity: 0.000000
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    sea_surface_wave_period_at_variance_spectral_density_maximum: 0.000000
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    sea_surface_wave_mean_period_from_variance_spectral_density_second_frequency_moment: 0.000000
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    sea_ice_area_fraction: 0.000000
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    sea_ice_x_velocity: 0.000000
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    sea_ice_y_velocity: 0.000000
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    ocean_vertical_diffusivity: 0.020000
    17:25:11 INFO    opendrift.models.basemodel.environment:248:    ocean_mixed_layer_thickness: 50.000000
    17:25:11 INFO    opendrift.models.basemodel:932: Using existing reader for land_binary_mask
    17:25:11 INFO    opendrift.models.basemodel:943: All points are in ocean
    17:25:11 INFO    opendrift.models.openoil.openoil:684: Oil-water surface tension is 0.035935 Nm
    17:25:11 INFO    opendrift.models.openoil.openoil:697: Max water fraction not available for GENERIC BUNKER C, using default
    17:25:11 WARNING opendrift.models.basemodel:726: Seafloor check not being run because environment is missing. This will happen the first time the function is run but if it happens subsequently there is probably a problem.
    17:25:11 INFO    opendrift.models.basemodel:2032: 2025-01-14 14:00:00 - step 1 of 48 - 2000 active elements (0 deactivated)
    17:25:14 INFO    opendrift.models.basemodel:2032: 2025-01-14 14:15:00 - step 2 of 48 - 2000 active elements (0 deactivated)
    17:25:17 INFO    opendrift.models.basemodel:2032: 2025-01-14 14:30:00 - step 3 of 48 - 2000 active elements (0 deactivated)
    17:25:17 INFO    opendrift.models.basemodel:2032: 2025-01-14 14:45:00 - step 4 of 48 - 2000 active elements (0 deactivated)
    17:25:17 INFO    opendrift.models.basemodel:2032: 2025-01-14 15:00:00 - step 5 of 48 - 2000 active elements (0 deactivated)
    17:25:17 INFO    opendrift.models.basemodel:2032: 2025-01-14 15:15:00 - step 6 of 48 - 2000 active elements (0 deactivated)
    17:25:20 INFO    opendrift.models.basemodel:2032: 2025-01-14 15:30:00 - step 7 of 48 - 2000 active elements (0 deactivated)
    17:25:20 INFO    opendrift.models.basemodel:2032: 2025-01-14 15:45:00 - step 8 of 48 - 2000 active elements (0 deactivated)
    17:25:20 INFO    opendrift.models.basemodel:2032: 2025-01-14 16:00:00 - step 9 of 48 - 2000 active elements (0 deactivated)
    17:25:20 INFO    opendrift.models.basemodel:2032: 2025-01-14 16:15:00 - step 10 of 48 - 2000 active elements (0 deactivated)
    17:25:22 INFO    opendrift.models.basemodel:2032: 2025-01-14 16:30:00 - step 11 of 48 - 2000 active elements (0 deactivated)
    17:25:22 INFO    opendrift.models.basemodel:2032: 2025-01-14 16:45:00 - step 12 of 48 - 2000 active elements (0 deactivated)
    17:25:23 INFO    opendrift.models.basemodel:2032: 2025-01-14 17:00:00 - step 13 of 48 - 2000 active elements (0 deactivated)
    17:25:23 INFO    opendrift.models.basemodel:2032: 2025-01-14 17:15:00 - step 14 of 48 - 2000 active elements (0 deactivated)
    17:25:25 INFO    opendrift.models.basemodel:2032: 2025-01-14 17:30:00 - step 15 of 48 - 2000 active elements (0 deactivated)
    17:25:25 INFO    opendrift.models.basemodel:2032: 2025-01-14 17:45:00 - step 16 of 48 - 2000 active elements (0 deactivated)
    17:25:25 INFO    opendrift.models.basemodel:2032: 2025-01-14 18:00:00 - step 17 of 48 - 2000 active elements (0 deactivated)
    17:25:25 INFO    opendrift.models.basemodel:2032: 2025-01-14 18:15:00 - step 18 of 48 - 2000 active elements (0 deactivated)
    17:25:28 INFO    opendrift.models.basemodel:2032: 2025-01-14 18:30:00 - step 19 of 48 - 2000 active elements (0 deactivated)
    17:25:28 INFO    opendrift.models.basemodel:2032: 2025-01-14 18:45:00 - step 20 of 48 - 2000 active elements (0 deactivated)
    17:25:28 INFO    opendrift.models.basemodel:2032: 2025-01-14 19:00:00 - step 21 of 48 - 2000 active elements (0 deactivated)
    17:25:28 INFO    opendrift.models.basemodel:2032: 2025-01-14 19:15:00 - step 22 of 48 - 2000 active elements (0 deactivated)
    17:25:30 INFO    opendrift.models.basemodel:2032: 2025-01-14 19:30:00 - step 23 of 48 - 2000 active elements (0 deactivated)
    17:25:31 INFO    opendrift.models.basemodel:2032: 2025-01-14 19:45:00 - step 24 of 48 - 2000 active elements (0 deactivated)
    17:25:31 INFO    opendrift.models.basemodel:2032: 2025-01-14 20:00:00 - step 25 of 48 - 2000 active elements (0 deactivated)
    17:25:31 INFO    opendrift.models.basemodel:2032: 2025-01-14 20:15:00 - step 26 of 48 - 2000 active elements (0 deactivated)
    17:25:33 INFO    opendrift.models.basemodel:2032: 2025-01-14 20:30:00 - step 27 of 48 - 2000 active elements (0 deactivated)
    17:25:33 INFO    opendrift.models.basemodel:2032: 2025-01-14 20:45:00 - step 28 of 48 - 2000 active elements (0 deactivated)
    17:25:33 INFO    opendrift.models.basemodel:2032: 2025-01-14 21:00:00 - step 29 of 48 - 2000 active elements (0 deactivated)
    17:25:34 INFO    opendrift.models.basemodel:2032: 2025-01-14 21:15:00 - step 30 of 48 - 2000 active elements (0 deactivated)
    17:25:36 INFO    opendrift.models.basemodel:2032: 2025-01-14 21:30:00 - step 31 of 48 - 2000 active elements (0 deactivated)
    17:25:36 INFO    opendrift.models.basemodel:2032: 2025-01-14 21:45:00 - step 32 of 48 - 2000 active elements (0 deactivated)
    17:25:36 INFO    opendrift.models.basemodel:2032: 2025-01-14 22:00:00 - step 33 of 48 - 2000 active elements (0 deactivated)
    17:25:36 INFO    opendrift.models.basemodel:2032: 2025-01-14 22:15:00 - step 34 of 48 - 2000 active elements (0 deactivated)
    17:25:38 INFO    opendrift.models.basemodel:2032: 2025-01-14 22:30:00 - step 35 of 48 - 2000 active elements (0 deactivated)
    17:25:38 INFO    opendrift.models.basemodel:2032: 2025-01-14 22:45:00 - step 36 of 48 - 2000 active elements (0 deactivated)
    17:25:38 WARNING opendrift.readers.basereader.structured:326: Data block from https://thredds.met.no/thredds/dodsC/sea/norkyst800m/1h/aggregate_be not large enough to cover element positions within timestep. Buffer size (8) must be increased. See `Variables.set_buffer_size`.
    17:25:39 WARNING opendrift.readers.basereader.structured:326: Data block from https://thredds.met.no/thredds/dodsC/sea/norkyst800m/1h/aggregate_be not large enough to cover element positions within timestep. Buffer size (8) must be increased. See `Variables.set_buffer_size`.
    17:25:39 INFO    opendrift.models.basemodel:2032: 2025-01-14 23:00:00 - step 37 of 48 - 2000 active elements (0 deactivated)
    17:25:39 INFO    opendrift.models.basemodel:2032: 2025-01-14 23:15:00 - step 38 of 48 - 2000 active elements (0 deactivated)
    17:25:48 INFO    opendrift.models.basemodel:2032: 2025-01-14 23:30:00 - step 39 of 48 - 2000 active elements (0 deactivated)
    17:25:48 INFO    opendrift.models.basemodel:2032: 2025-01-14 23:45:00 - step 40 of 48 - 2000 active elements (0 deactivated)
    17:25:48 INFO    opendrift.models.basemodel:2032: 2025-01-15 00:00:00 - step 41 of 48 - 2000 active elements (0 deactivated)
    17:25:48 INFO    opendrift.models.basemodel:2032: 2025-01-15 00:15:00 - step 42 of 48 - 2000 active elements (0 deactivated)
    17:25:50 INFO    opendrift.models.basemodel:2032: 2025-01-15 00:30:00 - step 43 of 48 - 2000 active elements (0 deactivated)
    17:25:50 INFO    opendrift.models.basemodel:2032: 2025-01-15 00:45:00 - step 44 of 48 - 2000 active elements (0 deactivated)
    17:25:50 INFO    opendrift.models.basemodel:2032: 2025-01-15 01:00:00 - step 45 of 48 - 2000 active elements (0 deactivated)
    17:25:50 INFO    opendrift.models.basemodel:2032: 2025-01-15 01:15:00 - step 46 of 48 - 2000 active elements (0 deactivated)
    17:25:52 INFO    opendrift.models.basemodel:2032: 2025-01-15 01:30:00 - step 47 of 48 - 2000 active elements (0 deactivated)
    17:25:52 INFO    opendrift.models.basemodel:2032: 2025-01-15 01:45:00 - step 48 of 48 - 2000 active elements (0 deactivated)
    17:25:52 WARNING opendrift.readers.basereader.structured:326: Data block from https://thredds.met.no/thredds/dodsC/sea/norkyst800m/1h/aggregate_be not large enough to cover element positions within timestep. Buffer size (8) must be increased. See `Variables.set_buffer_size`.
    17:25:52 WARNING opendrift.readers.basereader.structured:326: Data block from https://thredds.met.no/thredds/dodsC/sea/norkyst800m/1h/aggregate_be not large enough to cover element positions within timestep. Buffer size (8) must be increased. See `Variables.set_buffer_size`.
    17:25:53 INFO    opendrift.export.io_netcdf:121: Wrote 25 steps to file oilmixing.nc
    17:25:53 WARNING py.warnings:109: /opt/conda/envs/opendrift/lib/python3.11/site-packages/numpy/ma/core.py:467: RuntimeWarning: invalid value encountered in cast
      fill_value = np.array(fill_value, copy=False, dtype=ndtype)





.. GENERATED FROM PYTHON SOURCE LINES 38-39

Print and plot results

.. GENERATED FROM PYTHON SOURCE LINES 39-49

.. code-block:: Python

    print(o)

    o.plot(linecolor='z', fast=True)
    o.plot_property('z')
    o.plot_oil_budget()
    o.animation(fast=True)
    o.animate_vertical_distribution()

    os.remove(ncfile)  # cleaning up




.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /gallery/images/sphx_glr_example_oil_verticalmixing_001.png
         :alt: OpenDrift - OpenOil (GENERIC BUNKER C) 2025-01-14 14:00 to 2025-01-15 02:00 UTC (25 steps)
         :srcset: /gallery/images/sphx_glr_example_oil_verticalmixing_001.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /gallery/images/sphx_glr_example_oil_verticalmixing_002.png
         :alt: z
         :srcset: /gallery/images/sphx_glr_example_oil_verticalmixing_002.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /gallery/images/sphx_glr_example_oil_verticalmixing_003.png
         :alt: GENERIC BUNKER C (988.1 kg/m3) - 2025-01-14 14:00 to 2025-01-15 02:00
         :srcset: /gallery/images/sphx_glr_example_oil_verticalmixing_003.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    ===========================
    --------------------
    Reader performance:
    --------------------
    https://thredds.met.no/thredds/dodsC/sea/norkyst800m/1h/aggregate_be
     0:00:36.0  total
     0:00:00.0  preparing
     0:00:35.0  reading
     0:00:00.6  interpolation
     0:00:00.0  interpolation_time
     0:00:00.9  rotating vectors
     0:00:00.0  masking
    --------------------
    https://thredds.met.no/thredds/dodsC/mepslatest/meps_lagged_6_h_latest_2_5km_latest.nc
    --------------------
    global_landmask
     0:00:00.0  total
     0:00:00.0  preparing
     0:00:00.0  reading
     0:00:00.0  masking
    --------------------
    Performance:
       53.8 total time
       12.4 configuration
        0.1 preparing main loop
          0.0 moving elements to ocean
       41.2 main loop
          4.1 updating elements
            1.8 oil weathering
              0.0 updating viscosities
              0.0 updating densities
              1.7 evaporation
              0.0 emulsification
              0.0 dispersion
            2.1 vertical mixing
        0.0 cleaning up
    --------------------
    ===========================
    Model:  OpenOil     (OpenDrift version 1.12.0)
            2000 active Oil particles  (0 deactivated, 0 scheduled)
    -------------------
    Environment variables:
      -----
      sea_floor_depth_below_sea_level
      sea_surface_height
      sea_water_salinity
      sea_water_temperature
      upward_sea_water_velocity
      x_sea_water_velocity
      y_sea_water_velocity
         1) https://thredds.met.no/thredds/dodsC/sea/norkyst800m/1h/aggregate_be
      -----
      x_wind
      y_wind
         1) https://thredds.met.no/thredds/dodsC/sea/norkyst800m/1h/aggregate_be
         2) https://thredds.met.no/thredds/dodsC/mepslatest/meps_lagged_6_h_latest_2_5km_latest.nc
      -----
      land_binary_mask
         1) global_landmask
      -----
    Readers not added for the following variables:
      ocean_mixed_layer_thickness
      ocean_vertical_diffusivity
      sea_ice_area_fraction
      sea_ice_x_velocity
      sea_ice_y_velocity
      sea_surface_wave_mean_period_from_variance_spectral_density_second_frequency_moment
      sea_surface_wave_period_at_variance_spectral_density_maximum
      sea_surface_wave_significant_height
      sea_surface_wave_stokes_drift_x_velocity
      sea_surface_wave_stokes_drift_y_velocity

    Discarded readers:

    Time:
            Start: 2025-01-14 14:00:00 UTC
            Present: 2025-01-15 02:00:00 UTC
            Calculation steps: 48 * 0:15:00 - total time: 12:00:00
            Output steps: 25 * 0:30:00
    ===========================

    17:25:53 WARNING opendrift.models.basemodel:2407: Plotting fast. This will make your plots less accurate.
    17:26:20 WARNING opendrift.models.basemodel:2407: Plotting fast. This will make your plots less accurate.
    /opt/conda/envs/opendrift/lib/python3.11/site-packages/cartopy/mpl/geoaxes.py:1692: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored
      result = super().scatter(*args, **kwargs)
    17:26:21 INFO    opendrift.models.basemodel:4606: Saving animation to /root/project/docs/source/gallery/animations/example_oil_verticalmixing_0.gif...
    17:26:37 INFO    opendrift.models.basemodel:3034: Time to make animation: 0:00:17.558495
    17:26:38 INFO    opendrift.models.basemodel:4606: Saving animation to /root/project/docs/source/gallery/animations/example_oil_verticalmixing_1.gif...
    17:26:49 INFO    opendrift.models.oceandrift:713: Time to make animation: 0:00:12.192470




.. GENERATED FROM PYTHON SOURCE LINES 50-52

.. image:: /gallery/animations/example_oil_verticalmixing_0.gif
.. image:: /gallery/animations/example_oil_verticalmixing_1.gif


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (1 minutes 59.158 seconds)


.. _sphx_glr_download_gallery_example_oil_verticalmixing.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: example_oil_verticalmixing.ipynb <example_oil_verticalmixing.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: example_oil_verticalmixing.py <example_oil_verticalmixing.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: example_oil_verticalmixing.zip <example_oil_verticalmixing.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
