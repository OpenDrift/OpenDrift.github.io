

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data model &mdash; OpenDrift  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to choose which model to use" href="../choosing_a_model.html" />
    <link rel="prev" title="Specifications and background requirements" href="specification.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> OpenDrift
          

          
            
            <img src="../_static/opendrift_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction to OpenDrift</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../history_link.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing OpenDrift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Theory</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="specification.html">Specifications and background requirements</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Data model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../choosing_a_model.html">How to choose which model to use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing_a_new_model.html">How to write a new module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oil_types.html">Oil types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interaction_with_coastline.html">Interaction with coastline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gui.html">Graphical User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenDrift</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Theory</a> &raquo;</li>
        
      <li>Data model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/theory/data_model.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-model">
<h1>Data model<a class="headerlink" href="#data-model" title="Permalink to this headline">¶</a></h1>
<p>The OpenDrift framework is programmed in Python, and is based on four classes.
All classes are generic, and designed for specialisation by subclassing - ensuring flexibility, modularity and reusability.</p>
<ul class="simple">
<li><p><strong>Reader</strong> takes care of retrieving driver/forcing data for requested positions/time from a given data source (model or observations)</p></li>
<li><p><strong>LagrangianArray</strong> describes a particle type (e.g. oil, larvae…) and its properties (position, mass, length…)</p></li>
<li><p><strong>Writer</strong> writes output to a specific file format at each step or at end of simulation</p></li>
</ul>
<p>The main class (the “trajectory model”) ties it all together and takes care of any other tasks:
* <strong>OpenDriftSimulation</strong></p>
<blockquote>
<div><ul>
<li><p>Has an array of particles of a particular type (LagrangianArray)</p></li>
<li><p>Defines a spatial reference system (SRS), to which environmental data (from readers) will be interpolated</p></li>
<li><p>Methods for seeding/initialisation of particles.</p></li>
<li><p>Then for each time step (which might be negative):
* Uses a set of Readers to retrieve driver/environmental data for the positions of the elements</p>
<blockquote>
<div><ul class="simple">
<li><p>includes reprojecting and interpolation of values from the Readers SRS to the common simulation SRS</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Calls a purpose-specific method “update()” to update positions and properties of particles, based on environment data obtained by the readers.
* Deactivates particles (stranded, evaporated etc).</p></li>
<li><p>Calls a Writer to append output to file.</p></li>
</ul>
</li>
<li><p>Functionality to plot and analyse output/results (e.g as trajectories or concentration fields).</p></li>
</ul>
</div></blockquote>
<p>A subclass of OpenDriftSimulation defines (or imports/reuses) a particle type, and specifies a method to update particle properties based on environment variables (wind, waves, currents…). This function will focus only on the physical/chemical processes, and does not need to account for technical issues related to import, export, map projections etc.</p>
<p>A class diagram and a more detailed description of the classes is given below.</p>
<p>![](<a class="reference external" href="https://github.com/OpenDrift/opendrift/blob/master/docs/opendrift_UML.png">https://github.com/OpenDrift/opendrift/blob/master/docs/opendrift_UML.png</a>)</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a><a href="#id3"><span class="problematic" id="id4">*</span></a></p>
<p>### Reader
A “Reader” is a class to read/retrieve input/driver data from a particular source, or file format. This can be e.g. CF compliant NetCDF files, a specific model (ROMS) or source of observations (HF-radar, scatterometer…), with a specific file format/type, stored locally or retrieved through web protocols (e.g. OPeNDAP).
A Reader object must provide the following information, as reader by the class constructor (<code class="docutils literal notranslate"><span class="pre">`__init__`</span></code>):
* <strong>proj4</strong> (string)</p>
<blockquote>
<div><ul class="simple">
<li><p>declaring the spatial reference system (“projection”) for which data can be requested</p></li>
</ul>
</div></blockquote>
<ul>
<li><p><strong>xmin, xmax, delta_x, ymin, ymax, delta_y</strong> (floats)
* defining grid bounds and resolution
* x and y correspond to the given proj4 string</p></li>
<li><p><strong>time_start, time_end, time_step</strong> (datetime, timedelta)
* defining temporal availability of variables</p></li>
<li><p><strong>variables</strong> (list of strings)
* names of the variables which can be returned by this reader. Variable names must match names of the processes/functions of Model class (defined below) to allow generic use. This is ensured by using CF standard_name (whenever possible).</p></li>
<li><p><strong>function get_variables(variables, time, x, y, depths, block)</strong>
* input:</p>
<blockquote>
<div><ul class="simple">
<li><p>variables is a list of variable names (CF standard_name) to be read</p></li>
<li><p>x, y, depth are arrays with coordinates of the positions for which environment data should be obtained.</p></li>
<li><p>block is a boolean, meaning:
* True: a 3D block is returned for each requested variable, covering the requested x,y,depth space
* False: variables returned are valid for the exact requested positions. If requested positions are not exactly matching the spatial grid (defined by min/max/delta x,y,depth) of the Reader, the nearest points are returned.</p></li>
</ul>
</div></blockquote>
<ul>
<li><p>output:
* a dictionary with:</p>
<blockquote>
<div><ul class="simple">
<li><p>key: variable name</p></li>
<li><p>value: 3D array (<strong>depth, y, x</strong>), or a scalar/constant. A list of values (3D or scalar) is returned for an ensemble model. Missing values (outside of domain, on land etc should be represented as masked values (NaNs or masked array).</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>arrays with corresponding values of depth, y, x</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>A few Readers are contained within the core OpenDrift repository, but (expert) users may make their own Readers for (local) data sources of interest. Therefore Readers class is defined to take care of only the very specific task of retrieving requested variables for requested position and time. More complex tasks such as reprojection and interpolation in time and space is taken care of centrally, preventing duplication of code.</p>
<p>### LagrangianArray
A “LagrangianArray” is the base class for any types of drifting elements. A LagrangianArray has a number of variables stored in an OrderedDict, with properties such as <strong>dtype, unit, standard_name</strong> and <strong>default value</strong>. The base class has only variables <strong>lon, lat, depth</strong>
Subclasses of LagrangianArray will add more properties, such as e.g. density and viscosity for oil elements, and mass and size (length/radius) for fish eggs, larvae or rigid objects. All properties of a LagrangianElements are arrays, representing a number of elements. Properties may also be 1D arrays, meaning that the same value represents all particles.</p>
<p>### Model (subclass of OpenDriftSimulation)
A Model within the OpenDrift framework corresponds to the physics/chemistry/biology of a trajectory model in the classical sense (e.g. OD3D, Leeway, Ladim…). Any non-physical (technical) tasks are “outsourced” to other classes (Readers and Writers) and inherited/reused from classes LagrangianArray and OpenDriftSimulation.
A Model takes care of the processes affecting the particles (LagrangianArray) at each time step, such as:
* moving particles (x,y and vertical direction) in response to some forcing (e.g. current, wind, waves)
* changing any other properties of particles, as response to other physical proceses (evaporation, growth, capsizing…)
* check if particles are hitting land, and perform reponse (deactivating, rebouncing…)</p>
<p>All models must have a function update() which will be called each iteration of the trajectory simulation.
This method will use environment data (self.environment.x_sea_water_velocity, self.environment.y_sea_water_velocity, self.environment.x_wind, self.environment.sea_water_potential_temperature…) to update particle properties (self.elements.x, self.elements.depth, self.elements.mass…). The x-y coordinate frame is general, and the update function shall not “worry” about map projections and orientations etc.</p>
<p>Reader, LagrangianElement and OpenDriftSimulation are all [Abstract Base Classes](<a class="reference external" href="https://docs.python.org/2/library/abc.html">https://docs.python.org/2/library/abc.html</a>), meaning that they have to be subclassed/specialised to be used, and have to fulfil the mentioned capabilities.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../choosing_a_model.html" class="btn btn-neutral float-right" title="How to choose which model to use" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="specification.html" class="btn btn-neutral float-left" title="Specifications and background requirements" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Knut-Frode Dagestad et. al.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>