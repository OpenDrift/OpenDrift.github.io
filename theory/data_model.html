

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data model &mdash; OpenDrift  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to choose which model to use" href="../choosing_a_model.html" />
    <link rel="prev" title="Specifications and background requirements" href="specification.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OpenDrift
              <img src="../_static/opendrift_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction to OpenDrift</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../history_link.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing OpenDrift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance in OpenDrift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Theory</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lagrangian.html">Lagrangian simulation of drift trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="eulerian.html">Eulerian simulation of drift trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="specification.html">Specifications and background requirements</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Data model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reader">Reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lagrangianarray">LagrangianArray</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-subclass-of-opendriftsimulation">Model (subclass of OpenDriftSimulation)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#drift-in-the-ocean">Drift in the Ocean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../choosing_a_model.html">How to choose which model to use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing_a_new_model.html">How to write a new module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oil_types.html">Oil types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interaction_with_coastline.html">Interaction with coastline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">Using OpenDrift in a container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gui.html">Graphical User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services.html">Services using OpenDrift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenDrift</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Theory</a></li>
      <li class="breadcrumb-item active">Data model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/theory/data_model.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-model">
<h1>Data model<a class="headerlink" href="#data-model" title="Link to this heading"></a></h1>
<p>The OpenDrift framework is programmed in Python, and is based on four classes.
All classes are generic, and designed for specialisation by subclassing - ensuring flexibility, modularity and reusability.</p>
<ul class="simple">
<li><p><strong>Reader</strong> takes care of retrieving driver/forcing data for requested positions/time from a given data source (model or observations)</p></li>
<li><p><strong>LagrangianArray</strong> describes a particle type (e.g. oil, larvae…) and its properties (position, mass, length…)</p></li>
<li><p><strong>Writer</strong> writes output to a specific file format at each step or at end of simulation</p></li>
</ul>
<p>The main class (the “trajectory model”) ties it all together and takes care of any other tasks:</p>
<ul class="simple">
<li><p><strong>OpenDriftSimulation</strong></p>
<ul>
<li><p>Has an array of particles of a particular type (LagrangianArray)</p></li>
<li><p>Defines a spatial reference system (SRS), to which environmental data (from readers) will be interpolated</p></li>
<li><p>Methods for seeding/initialisation of particles.</p></li>
<li><p>Then for each time step (which might be negative):</p>
<ul>
<li><p>Uses a set of Readers to retrieve driver/environmental data for the positions of the elements</p>
<ul>
<li><p>includes reprojecting and interpolation of values from the Readers SRS to the common simulation SRS</p></li>
</ul>
</li>
<li><p>Calls a purpose-specific method “update()” to update positions and properties of particles, based on environment data obtained by the readers.</p>
<ul>
<li><p>Deactivates particles (stranded, evaporated etc).</p></li>
</ul>
</li>
<li><p>Calls a Writer to append output to file.</p></li>
</ul>
</li>
<li><p>Functionality to plot and analyse output/results (e.g as trajectories or concentration fields).</p></li>
</ul>
</li>
</ul>
<p>A subclass of OpenDriftSimulation defines (or imports/reuses) a particle type, and specifies a method to update particle properties based on environment variables (wind, waves, currents…). This function will focus only on the physical/chemical processes, and does not need to account for technical issues related to import, export, map projections etc.</p>
<p>A class diagram and a more detailed description of the classes is given below.</p>
<img alt="https://github.com/OpenDrift/opendrift/blob/master/docs/opendrift_UML.png?raw=true" src="https://github.com/OpenDrift/opendrift/blob/master/docs/opendrift_UML.png?raw=true" />
<section id="reader">
<h2>Reader<a class="headerlink" href="#reader" title="Link to this heading"></a></h2>
<p>A “Reader” is a class to read/retrieve input/driver data from a particular source, or file format. This can be e.g. CF compliant NetCDF files, a specific model (ROMS) or source of observations (HF-radar, scatterometer…), with a specific file format/type, stored locally or retrieved through web protocols (e.g. OPeNDAP).
A Reader object must provide the following information, as reader by the class constructor (<code class="docutils literal notranslate"><span class="pre">`__init__`</span></code>):</p>
<ul class="simple">
<li><p><strong>proj4</strong> (string)</p>
<ul>
<li><p>declaring the spatial reference system (“projection”) for which data can be requested</p></li>
</ul>
</li>
<li><p><strong>xmin, xmax, delta_x, ymin, ymax, delta_y</strong> (floats)</p>
<ul>
<li><p>defining grid bounds and resolution</p></li>
<li><p>x and y correspond to the given proj4 string</p></li>
</ul>
</li>
<li><p><strong>start_time, end_time, time_step</strong> (datetime, timedelta)</p>
<ul>
<li><p>defining temporal availability of variables</p></li>
</ul>
</li>
<li><p><strong>variables</strong> (list of strings)</p>
<ul>
<li><p>names of the variables which can be returned by this reader. Variable names must match names of the processes/functions of Model class (defined below) to allow generic use. This is ensured by using CF standard_name (whenever possible).</p></li>
</ul>
</li>
<li><p><strong>function get_variables(variables, time, x, y, depths, block)</strong></p>
<ul>
<li><p>input:</p>
<ul>
<li><p>variables is a list of variable names (CF standard_name) to be read</p></li>
<li><p>x, y, depth are arrays with coordinates of the positions for which environment data should be obtained.</p></li>
<li><p>block is a boolean, meaning:</p>
<ul>
<li><p>True: a 3D block is returned for each requested variable, covering the requested x,y,depth space</p></li>
<li><p>False: variables returned are valid for the exact requested positions. If requested positions are not exactly matching the spatial grid (defined by min/max/delta x,y,depth) of the Reader, the nearest points are returned.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>output:</p>
<ul>
<li><p>a dictionary with:</p>
<ul>
<li><p>key: variable name</p></li>
<li><p>value: 3D array (<strong>depth, y, x</strong>), or a scalar/constant. A list of values (3D or scalar) is returned for an ensemble model. Missing values (outside of domain, on land etc should be represented as masked values (NaNs or masked array).</p></li>
</ul>
</li>
<li><p>arrays with corresponding values of depth, y, x</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>A few Readers are contained within the core OpenDrift repository, but (expert) users may make their own Readers for (local) data sources of interest. Therefore Readers class is defined to take care of only the very specific task of retrieving requested variables for requested position and time. More complex tasks such as reprojection and interpolation in time and space is taken care of centrally, preventing duplication of code.</p>
</section>
<section id="lagrangianarray">
<h2>LagrangianArray<a class="headerlink" href="#lagrangianarray" title="Link to this heading"></a></h2>
<p>A “LagrangianArray” is the base class for any types of drifting elements. A LagrangianArray has a number of variables stored in an OrderedDict, with properties such as <strong>dtype, unit, standard_name</strong> and <strong>default value</strong>. The base class has only variables <strong>lon, lat, depth</strong>
Subclasses of LagrangianArray will add more properties, such as e.g. density and viscosity for oil elements, and mass and size (length/radius) for fish eggs, larvae or rigid objects. All properties of a LagrangianElements are arrays, representing a number of elements. Properties may also be 1D arrays, meaning that the same value represents all particles.</p>
</section>
<section id="model-subclass-of-opendriftsimulation">
<h2>Model (subclass of OpenDriftSimulation)<a class="headerlink" href="#model-subclass-of-opendriftsimulation" title="Link to this heading"></a></h2>
<p>A Model within the OpenDrift framework corresponds to the physics/chemistry/biology of a trajectory model in the classical sense (e.g. OD3D, Leeway, Ladim…). Any non-physical (technical) tasks are “outsourced” to other classes (Readers and Writers) and inherited/reused from classes LagrangianArray and OpenDriftSimulation.
A Model takes care of the processes affecting the particles (LagrangianArray) at each time step, such as:</p>
<ul class="simple">
<li><p>moving particles (x,y and vertical direction) in response to some forcing (e.g. current, wind, waves)</p></li>
<li><p>changing any other properties of particles, as response to other physical proceses (evaporation, growth, capsizing…)</p></li>
<li><p>check if particles are hitting land, and perform reponse (deactivating, rebouncing…)</p></li>
</ul>
<p>All models must have a function update() which will be called each iteration of the trajectory simulation.
This method will use environment data (self.environment.x_sea_water_velocity, self.environment.y_sea_water_velocity, self.environment.x_wind, self.environment.sea_water_potential_temperature…) to update particle properties (self.elements.x, self.elements.depth, self.elements.mass…). The x-y coordinate frame is general, and the update function shall not “worry” about map projections and orientations etc.</p>
<p>Reader, LagrangianElement and OpenDriftSimulation are all <a class="reference external" href="https://docs.python.org/2/library/abc.html">Abstract Base Classes</a>, meaning that they have to be subclassed/specialised to be used, and have to fulfil the mentioned capabilities.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="specification.html" class="btn btn-neutral float-left" title="Specifications and background requirements" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../choosing_a_model.html" class="btn btn-neutral float-right" title="How to choose which model to use" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Knut-Frode Dagestad (knutfd@met.no) and Gaute Hope (gauteh@met.no)..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>